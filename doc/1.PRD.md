# **Product Requirement Document (PRD): Kernel**

**Version**: 2.3  **Language**: Traditional Chinese (繁體中文)  **Status**: Planning

---

# **1. 產品概述 (Product Overview)**

## **1.1 產品願景 (Vision)**

**Kernel** 是一款專為高效能知識工作者設計，整合資訊管理、目標執行與量化追蹤的個人效能系統。它旨在解決現代人資訊焦慮、執行力不足與生活缺乏反思的問題。透過整合 PARA 方法論、原子習慣 (Atomic Habits) 與量化自我 (Quantified Self) 概念，打造一個從「快速捕捉」到「深度執行」再到「系統回顧」，形成一個可持續運作的個人系統。

> 這不是另一個「更強大的筆記工具」，而是一個**讓個人知識管理、建立習慣、目標執行與自我觀察能夠可持續運作的完整系統**。
> 

## **1.2 目標用戶 (Target Audience)**

- **軟體工程師/開發者**: 需要管理多個 side projects、學習新技術棧、並保持深度工作狀態。
- **創意工作者/PM**: 需要捕捉大量靈感，並將其轉化為可執行的專案。
- **自我成長追求者**: 熱衷於數據化生活、習慣養成與日記反思。

## **1.3 核心概念與產品詞彙定義**

### 資源（Resource）

用於表示**一筆可被保存、引用與回溯的內容單位**，如文章、筆記、外部參考連結、會議重點或任何具有資訊價值的內容。

Resource 為**獨立存在的資訊實體**，不以資料夾、分類或實體檔案形式管理，而是透過與專案（Projects）與領域（Areas）的關聯，建立其存在脈絡與使用情境。

每一筆資源皆具備明確的狀態，用以反映其是否已完成決策與是否仍屬於當前關注重心。

資源可乘載以下內容：

- 標題
- 資源內容 (Content)
- 參考連結 (URL)
- 關聯專案
- 關聯領域
- 標籤
- 資源狀態 - 資源具備以下三種狀態：
    - **Pending**
        
        表示該資源尚未完成決策，尚未被歸屬至任何專案或領域。
        
        Pending 狀態之資源僅存在於 Inbox，用以承載尚待處理的內容。
        
    - **Processed**
        
        表示該資源已完成決策，並已至少關聯一個進行中專案（Project）或啟用中領域（Area），
        
        因而具備明確的使用脈絡，並可出現在資源庫中供後續查詢與使用。
        
    - **Archived**
        
        表示該資源已退出當前關注重心，
        
        不再具備任何有效的進行中專案或啟用中領域關聯。
        
        Archived 資源預設不顯示於資源庫列表，但仍可透過搜尋與篩選進行回溯。
        

---

### 收件匣（Inbox）

用於承載尚未完成決策的資源（Resources）之暫存視圖。

Inbox 並非獨立資料實體，而是所有 status = Pending 之 Resource 的集合視角，用以集中處理尚未被歸屬至任何專案（Project）或領域（Area）的內容。

Inbox 的設計目的在於促進決策與分流，而非作為長期存放或分類空間。

所有進入 Inbox 的資源，皆必須經由以下其中一種行為被處理：

- 分流至至少一個專案（Project）或領域（Area），並將狀態轉為 Processed
- 封存（Archived），表示暫時不納入當前關注重心
- 移除（Delete），表示不再保留該資源

系統不允許資源在未建立任何關聯的情況下，直接由 Pending 轉為 Processed，以避免形成無上下文之資源堆積。

---

### 資源庫（Resource Library）

用於**陳列、瀏覽與查詢已完成決策之資源（Resources）**的聚合視圖。

資源庫包含所有狀態為 Processed 與 Archived 之資源，

並作為使用者回溯、搜尋與再利用資源的主要入口。

資源庫本身並非實體儲存位置，而是一個依據資源狀態所組成的聚合視圖（Aggregated View）。

資源是否顯示於資源庫，取決於其當前狀態：

- 狀態為 Pending 之資源，代表尚未完成決策，僅存在於 Inbox，不顯示於資源庫
- 狀態為 Processed 之資源，代表具備有效關聯脈絡，預設顯示於資源庫
- 狀態為 Archived 之資源，代表已退出當前關注重心，預設不顯示於資源庫列表，但可透過搜尋或篩選條件被查詢與回溯

資源庫的設計目的在於提供一個低噪音、可回溯的資源查詢空間，而非暫存或待處理區域。

---

### 專案（Project）

用於管理具備明確目標、可被完成之工作單位。

Project 代表一段需要被推進並做出明確決策結果的行動歷程，其存在目的在於將目標拆解為可執行的任務（Tasks），並追蹤行動的完成與中止結果。

每一個專案皆必須關聯至少一個領域（Area），

以確保其行動具有明確的長期責任脈絡，而非獨立存在的工作片段。

專案可承載以下內容：

- 專案名稱
- 任務（Tasks）與任務清單（Task Lists）
- 專案進度（依任務完成情況計算）
- 專案摘要與說明
- 隸屬領域 (Area) (非必要)
- 相關資源（Resources）之關聯
- 截止日期
- 專案狀態 - 專案具備明確且有限的狀態，用以反映其行動推進與決策結果：
    - Active（進行中）：專案目前仍在推進，尚未達成其完成條件
    - Completed（已完成）：專案目標已達成，行動層級正式結束，為終態狀態
    - Archived（封存）：專案在未完成的情況下被中止或擱置，代表一個未完成但已被放下的決定
        
        專案僅允許以下狀態轉換：
        
        - Active → Completed （達成目標）
        - Active → Archived （中止 / 擱置）
        - Archived → Active （重啟專案）
        

---

### 任務（Tasks）

用於描述專案（Project）中可執行、可完成的具體行動單位。

Task 隸屬於單一專案（Project），並用以拆解專案目標、追蹤執行進度與完成狀態。

任務本身不承載長期狀態或知識內容，而僅代表「是否已完成」的執行結果。

任務可依需求被組織於多個任務清單（Task Lists）之下，以反映不同階段或工作流程，但所有任務皆服務於其所屬專案之完成。

任務完成情況將用於計算與呈現專案進度，惟不影響資源（Resource）、日記（Journal）或指標（Metrics）之狀態。

---

### 領域（Area）

用於描述長期存在、無明確結束時間的人生責任範圍或生活面向。

Area 並非用於管理任務或推進目標，而是作為專案（Projects）與習慣（Habits）的結構性背景，

用以界定使用者在不同人生面向中所承擔的持續責任。

領域本身不具備完成狀態，

其狀態僅反映該責任範圍目前是否仍屬於使用者的關注視野。

領域可承載與影響以下內容：

- 長期維持行為之習慣（Habits）
- 隸屬於該領域之專案（Projects）
- 與該領域相關之資源（Resources）關聯
- 領域狀態 - 領域僅具備以下兩種狀態：
    - Active（啟用中）：該領域仍屬於當前關注的人生版圖
    - Hidden（隱藏）：該領域暫時退出關注視野，但不代表其重要性被否定
    
    領域不具備完成或封存之語意，狀態僅代表注意力的退場，而非責任的結束。
    

---

### 習慣（Habits）

用於描述為維持某一領域（Area）而需持續重複進行的行為承諾。

Habit 隸屬於單一領域（Area），並以每日是否執行為主要記錄方式。

習慣不以完成為目標，亦不具備結束條件，其存在目的在於支持長期狀態的維持，而非推進特定成果。

在日記（Journal）中，習慣以每日勾選清單（Checklist）形式呈現，用於記錄該行為於當日是否發生，而不進行評價、累積成就或連續性計算。

習慣之勾選僅代表行為發生與否，不直接影響指標（Metrics）數值，亦不轉化為任務或資源。

---

### 封存（Archive）

本產品中不存在傳統意義上的檔案封存機制。

封存代表資源（Resource）狀態轉換為 Archived，用以表示該資源不再屬於當前關注重心，但仍可被搜尋與回溯，且不影響資料完整性。

---

### 日記（Journal）

用於記錄**每日狀態與觀察結果的時間型容器**。

Journal 本身不承載長期結構或核心資料，

呈現該日所對應的行為、狀態與觀察紀錄。

在 Journal 中，使用者可進行以下紀錄行為：

- 勾選當日習慣（Habits）之執行情況
- 填寫指標（Metrics）之當日數值
- 檢視當日仍在進行中的專案（Projects）
- 檢視中尚未分流或封存決策之資源 (Pending Resources)
- 撰寫當日的文字記錄與摘要

Journal 不負責建立、管理或評價專案、習慣與指標本身，僅作為這些結構在特定日期下的**使用與觀察介面**。

Journal 的設計目的在於提供一個低干擾、可回溯的每日視角，協助使用者理解狀態的變化，而非追求效率、連續性或績效評分。

---

### 指標（Metrics）

由使用者定義的「需被長期觀察與量化的狀態」。

Metrics 為獨立存在的觀測項目，可於 Journal 中被重複量測，並用於分析趨勢、關聯性與長期變化。

---

# 2. 非功能性需求 (**Non-Functional Requirements)**

## 2.1 多語系支援 (i18n)

系統未來可支援多語系擴展，開發階段首先支援繁體中文

## **2.2 保密性 (Confidentiality)**

敏感數據（如密碼、支付資訊）必須經過加密（例如 256-bit AES），在傳輸和儲存時都不能被未經授權者讀取。

## **2.3 完整性 (Integrity)**

防止數據在儲存或傳輸過程中被惡意篡改或意外損壞。

## **2.4 授權與訪問控制 (Authorization & Access Control)**

基於用戶角色和權限，限制對特定數據和功能的訪問。

## **2.5防護與防禦 (Protection & Defense)**

抵禦各種網路攻擊，如 DDoS、SQL 注入、跨站腳本（XSS）等。

## **2.6 合規性 (Compliance)**

遵守相關的數據保護法規（如 GDPR, CCPA）。

## **2.7 事件日誌與監控 (Logging & Monitoring)**

記錄所有安全相關事件及重要操作，以便追溯和調查。

# **3. 功能詳細規格 (Detailed Functional Specs)**

> [!NOTE] 
> 本章節專注於 UI 行為與功能邏輯。
> 詳細的 **API 契約 (Inputs/Outputs)** 請參閱 `doc/3.interface_contracts.md`。
> 詳細的 **資料實體 (Data Schema)** 請參閱 `doc/2.dataModel.md`。

## 3.0 全站畫面布局 (Layout)

### 說明
系統採用 **左側導航 (Sidebar) + 頂部工具列 (Top Bar) + 主要內容區 (Main Content)** 的經典佈局，確保操作效率與資訊呈現的最大化。

### 布局

*   **左側導航欄 (Sidebar)**:
    *   **頂部**: App名稱 (Kernel) 及 收折 Sidebar 按紐。
    *   **快速捕捉按鈕**: `(+) New Resource`，隨時開啟 Capture Modal 紀錄想法。
    *   **核心導航**: Inbox, Projects, Areas, Resources, Metrics, Journal。
    *   **近期開啟 (Recent)**: 顯示近期開啟的六個資源/專案/領域。
    *   **底部**: 會員資訊摘要 (頭像、名稱、方案)。

*   **頂部工具列 (Top Bar)**:
    *   **全域搜尋 (Global Search)** (middle): 快速查找資源、專案、領域 (Command Palette 形式)。

*   **主要內容區 (Main Content)**:
    *   顯示各功能模組的核心內容，支援響應式設計。

### 行為

*   **App 名稱**: 點擊可回到首頁 (預設為 Inbox List)。
*   **收折按鈕**: 點擊可收折 Sidebar (收折後只顯示展開按鈕、快速捕捉圖示、核心導航圖示、會員頭像)。
*   **全域搜尋框**: 
    *   點擊彈出類似 Command Palette 的 Dropdown。
    *   預設內容為近期開啟的 10 個資源/專案/領域。
    *   輸入文字後即時顯示對應查找內容。
*   **近期開啟 (Recent)**: 點擊Recent標題可以 Show/Hide 下方顯示的內容清單。

![Kernel 3.0 Layout Wireframe Specific](./wireframe/3.0_layout.png)


## 3.1 會員系統 (Membership & Auth System)

### 說明
管理使用者的身分驗證、個人檔案與偏好設定。
*   **安全優先**: 採用標準 OAuth 2.0 與 JWT 機制。
*   **個人化**: 支援個人資料管理與介面偏好設定 (Theme/Language)。

### 3.1.1 登入與註冊頁 (Authentication Page)

*   **說明**:
    *   使用者的入口大門。
    *   **身分驗證提供者**: 目前僅支援 **GitHub** 與 **Google** 第三方登入。
*   **布局**:
    *   **置中卡片式設計**: 聚焦於登入按鈕。
    *   **背景**: 沉穩的深色背景配上極光/流光效果 (Brand Glow)。
*   **元件**:
    *   **Logo Area**: Kernel 品牌標誌。
    *   **Social Connections**: 兩個主要按鈕 (Continue with Google, Continue with GitHub)。
    *   **Footer**: 服務條款連結。
*   **行為**:
    *   **OAuth 流程**: 點擊按鈕後導向 Provider 授權頁面，回調後自動建立帳號或登入。
*   **UI 示意圖**:

![Login Page V2 UI](./wireframe/3.1.1_login.png)


## 3.2 收件匣 (Inbox)

### 說明
Inbox 是資訊進入系統的緩衝區。所有未分類的資源 (Resources) 皆匯集於此，設計核心在於「降低捕捉門檻」與「高效率分流」。

*   **快速捕捉 (Quick Capture)**: 支援全域快捷鍵開啟，隨時保留靈感，不打斷當前工作流。
*   **資源分流 (Quick Dispatch)**: 提供高效率的互動介面，將資源快速歸位至 PARA 系統 (Projects/Areas/Trash/Archive)。

### 3.2.1 收件匣清單頁 (Inbox List Page)

*   **說明**:
    *   顯示所有狀態為 `Pending` 的資源列表。
    *   作為 Inbox 的預設視圖，設計目標是「鼓勵清空 (Inbox Zero)」。
*   **布局**:
    *   **頂部**: 頁面標題 "Inbox"、資源計數器 (e.g., "Inbox (3)")、排序/篩選工具列 (預設依建立時間倒序)。
    *   **列表區**: 佔據主要畫面，以單欄列表呈現每筆資源。
*   **元件**:
    *   **清單項目 (List Item)**:
        *   **類型圖示**: 目前僅支援筆記 (Note) 類型。
        *   **標題 (Title)**: 資源的主要描述。
        *   **摘要 (Snippet)**: 顯示內文前 50 字預覽。
        *   **時間戳記**: 顯示「多久前建立 (e.g., 2h ago)」，增加處理急迫感。
        *   **懸停動作 (Hover Actions)**: `Link to Project/Area` (開啟分流選單), `Archive`, `Delete` 快速按鈕。
    *   **空狀態 (Empty State)**: 當清單清空時，顯示 "Inbox Zero" 的獎勵插圖與激勵文字。
*   **行為**:
    *   **點擊項目**: 於右側滑出「資源預覽/編輯窗格」或跳轉至「資源內容編輯頁」(視螢幕寬度而定)。
    *   **資源分流 (Link/Dispatch)**: 
        *   點擊 `Link to Project/Area` 按鈕後，彈出 **Command Palette 形式** 的下拉選單。
        *   選單支援搜尋與 **多選 (Multi-select)** 專案或領域。
        *   選擇完畢後點擊確認，將資源關聯至選中目標並根據狀態邏輯自動標記為 `Processed`。
    *   **拖曳排序**: 允許基本排序調整 (雖主要依賴時間，但支援手動優先級調整)。

### 3.2.2 資源內容編輯頁 (Resource Content Page)

*   **說明**: 檢視資源完整內容並進行深度整理與分類的頁面。
*   **布局**:
    *   **主內容欄**: 標題輸入框 (Title)、編輯器 (Content)。若是 URL 類型，顯示 OpenGraph 預覽卡片。
    *   **屬性側欄 (Properties Sidebar)**:
        *   **已分流目標**: 顯示 `linkedProjects` 與 `linkedAreas` 中的所有關聯目標。
        *   **分流工具 (Dispatch Tool)**: 透過 Command Palette 形式的選單，新增或移除關聯的 Project / Area。
        *   **標籤 (Tags)**: 標籤輸入與管理。
        *   **參考連結 (Source Link)**: 可選欄位 (URL)，若存在則顯示外部連結圖示與連結。
*   **行為**:
    *   **自動儲存**: 編輯過程中即時 Autosave。
    *   **分流確認**: 
        *   當使用者選擇了 Project 或 Area 後，需顯示一個顯性的「Process & Next」按鈕，點擊後將狀態更新為 `Processed` 並自動導向 Inbox 下一筆待處理項目。
        *   若使用者未點擊按鈕 (例如直接切換頁面)，只要已建立關聯，狀態亦自動變更為 `Processed`。

![Resource Editor/Processing UI](./wireframe/3.2.2_resource_editor.png)


### 3.2.3 快速捕捉視窗 (Quick Capture Modal)

*   **說明**: 隨時隨地開啟的浮動視窗，用於極速輸入。
*   **布局**:
    *   畫面正中央顯示對話框 (Dialog)。
    *   極簡設計：僅包含一個多行輸入框與簡易工具列。
    *   **智慧解析 (Smart Parsing)**:
        *   **情境 A：輸入僅包含 URL**
            *   系統自動抓取該 URL 的標題與 Metadata，並轉換為 Markdown 內容存入 `content`。
            *   該 URL 同步儲存至 `sourceLink` 欄位。
        *   **情境 B：輸入包含自定義內容 (不論是否含 URL)**
            *   第一行自動設為標題 (Title)。
            *   其餘內容存入筆記主體 (Content)。
            *   此情境下不自動轉存 `sourceLink`，以內容原樣為主。
    *   **快捷鍵**:
        *   `Cmd/Ctrl + Enter`: 儲存並關閉。
        *   `Esc`: 取消。
*   **UI 示意圖**:

![Inbox UI Wireframe](./wireframe/3.2.1_inbox_list.png)


## 3.3 專案管理 (Projects)

### 說明
管理所有具備明確結束條件的任務集合。
*   **目標導向 (Goal-Oriented)** 設計，每個行動都應服務於更長遠的目標。
*   **多視圖切換**: 支援 **看板 (Kanban)** 與 **清單 (List)** 視圖，適應不同管理需求。

### 3.3.1 專案列表頁 (Project List Page)

*   **說明**:
    *   除專案列表外，新增 **工作台 (Workbench)** 概念，作為跨專案的任務聚合視圖，讓使用者聚焦於「今天該做什麼」。
*   **布局**:
    *   頁面分為上下兩部分，頂部標題 "Projects" 旁邊新增 [New Project (+)] 按紐。
    *   **上半部 - 工作台 (Workbench)**:
        *   **左側 (Doing)**: 「當前正在處理」的工作焦點。使用者主動拖曳右側 Todo 清單中的 Task 選入。
        *   **右側 (Todo)**: 顯示所有 `Active` 專案中的未完成任務聚合清單。
    *   **下半部 - 專案列表 (Project List)**:
        *   包含狀態篩選按鈕 (Active/Completed/Archived) 與專案卡片網格/列表。
        *   **專案卡片 (Project Card)**:
            *   **狀態標籤 (Status Tag)**: 根據專案狀態顯示不同顏色的標籤 (Active/Completed/Archived)。
            *   **專案名稱 (Project Name)**: 顯示專案名稱，點擊進入專案詳情頁。
            *   **專案進度 (Project Progress)**: 顯示專案內已完成task/未完成task、進度百分比(進度條形式)。
*   **行為**:
    *   **Workbench 互動**:
        *   **選入任務**: 從右側 Todo 拖曳任務至左側 Doing，代表鎖定焦點。
        *   **完成任務**: 在 Doing 區勾選完成，該任務以灰底顯示 (未離開頁面前可 Undo)。
    *   **Todo 來源**: 自動聚合所有 Status=`Active` 專案內的未完成 Tasks。
    *   **版面調整**: 使用者可上下拖曳 Workbench 與 Project List 之間的分界線，自定義兩區域的高度比例。
    *   **新增專案 (Create Project)**:
        *   **點擊 [+] 按紐開啟 [Create Modal]。**
        *   **欄位：Project Name (必填), Related Area (選填), Due Date (選填)。**
        *   **提交後行為：點擊確認後，系統將自動建立專案並直接跳轉至該專案的詳情頁，以便用戶立即開始拆解任務。**

### 3.3.2 專案詳情頁 (Project Detail Page)

*   **說明**: 單一專案的執行中樞，整合任務、資源與筆記。
*   **布局**:
    *   **兩欄式佈局**: 主內容區 (70%) + 右側資訊欄 (30%)。
    *   **頁頭**: 顯示專案名稱 (Project Name) 右側新增Delete按鈕。
    *   **主內容區 (Main Content)**:
        *   **專案進度 (Project Progress)**: 顯示 `x / y 任務完成` 及對應百分比進度條。
        *   **專案摘要 (Project Summary)**: 支援 Markdown 語法的文字區塊，用於描述專案目標與背景。
        *   **任務清單區 (Task Lists)**: 垂直排列的多個任務清單群組 (Grouped by TaskList)。
    *   **右側側欄 (Context Sidebar)**:
        *   **狀態 (Status)**: Badge 顯示。
        *   **截止日期 (Due Date)**: 日期顯示。
        *   **所屬領域 (Area)**: 顯示關聯 Area。
        *   **關聯資源 (Linked Resources)**: 顯示關鍵參考資料連結。
        *   **封存 (Archive)**: 按鈕。
        *   **刪除 (Delete)**: 按鈕。
*   **元件**:
    *   **任務清單 (Task List)**: 包含標題與其下的任務項目 (Checklist Item)。
    *   **任務項目**: 支援勾選完成状态、拖曳排序。
*   **行為**:
    *   **任務管理**: 在清單內直接新增、勾選完成任務。系統會自動重新計算上方進度條。
    *   **清單管理**: 可新增多個任務清單 (e.g., "Design Phase", "Backend Dev") 來分類任務。
    *   **編輯與管理 Actions**:
        *   **標題編輯**: 點擊專案名稱可直接進行原地編輯 (Inline Edit)。
        *   **Archive**: 將專案移至 Archive 狀態 (非刪除，可還原)。
        *   **Delete**: 硬刪除 (Hard Delete) 專案與其下所有任務 (需二次確認)。
    *   **任務與清單操作**:
        *   **Task Actions**: 懸停於任務時顯示 **[Edit]** (筆) 與 **[Delete]** (垃圾桶) 按紐。點擊文字亦可進入編輯模式。
        *   **List Actions**: 清單標題旁的選單提供 **[Rename]** 與 **[Delete List]** (刪除清單及內含任務)。

![Project Detail V2 UI](./wireframe/3.3.2_project_detail.png)


## 3.4 領域維護 (Areas)

### 說明
用於描述長期存在、無明確結束時間的人生責任範圍 or 生活面向。
*   **長期視角**: Area 不會被「完成」，只能被「維護」。
*   **責任歸屬**: 所有的 Project 與 Habit 都應歸屬於某個 Area，以確保行動與長期目標一致。

### 3.4.1 領域列表頁 (Area List Page)

*   **說明**:
    *   展示使用者的人生版圖全貌。
    *   強調視覺化的「領域感」，而非單純的清單。
*   **布局**:
    *   **網格視圖**: 採用較大尺寸的卡片網格 (Grid Layout)，強調封面圖視覺。 列表的最後一個位置顯示 [New Area (+)] 卡片。
*   **元件**:
    *   **領域卡片 (Area Card)**:
        *   **上半部**: 滿版封面圖 (Cover Image)。
        *   **下半部**: 領域名稱、狀態燈號 (Active/Hidden)、關鍵統計 (Active Projects / Habits)。
*   **行為**:
    *   **點擊卡片**: 進入「領域詳情頁」。
    *   **僅檢視狀態**: 列表頁不提供狀態切換功能，僅顯示當前狀態 (Active/Hidden)。
    *   **新增領域 (Create Area)**:
        *   開啟 [Create Modal]，輸入 Name 並選擇預設封面圖。提交後直接跳轉至領域詳情頁。

![Area List UI](./wireframe/3.4.1_area_list.png)

### 3.4.2 領域詳情頁 (Area Detail Page)

*   **說明**:
    *   單一領域的控制中心 (Hub)。
    *   負責該領域下的「專案 (Projects) 索引」與「習慣 (Habits) 管理」。
*   **布局**:
    *   **頁頭 (Header)**: 滿版背景圖 + 領域標題 + 核心統計數據。
    *   **兩欄式佈局**:
        *   **主內容區 (Main)**: 上方為習慣管理 (Habit Management)，下方為進行中專案 (Active Projects)。
        *   **右側側欄 (Sidebar)**: 領域描述 (Description)、關鍵資源連結 (Linked Resources)、區域狀態設定 (Hidden Toggle)、刪除領域按鈕 (Delete Area)。
*   **元件**:
    *   **習慣管理器 (Habit Manager)**:
        *   **清單呈現**: 每一列 **最前方** 以標籤 (Tag) 樣式顯示頻率，後方跟隨習慣名稱。
            *   樣式範例: `[Daily]` 閱讀 30 分鐘、`[Weekly - Mon]` 檢視週計畫。
        *   **頻率設定**: 僅支援 `Daily` 與 `Weekly` (需指定星期幾)。
        *   **操作**: 提供 **啟用/暫停** 開關、**編輯** 按鈕以及 [Delete] 按紐。
        *   (注意：此處不進行打卡，打卡行為位於日記功能)。
    *   **專案列表 (Project List)**: 嵌入精簡版的專案卡片，點擊跳轉至 Project Detail。
*   **行為**:
    *   **習慣管理**: 新增、編輯、暫停/啟用習慣。 支援刪除錯誤建立的習慣。
    *   **內容編輯**: 可直接點擊並編輯側欄的 **領域描述 (Description)**。
    *   **狀態切換**: 在側欄下方提供 "Hidden Area" 開關，將此領域隱藏或重新啟用。
    *   **編輯詳情**:
        *   **點擊 Header 封面圖: 上傳更換圖片。**
        *   **點擊 Area 標題: 原地重命名。**
    *   **刪除領域 (Delete)**:
        *   **側欄最下方提供 [Delete Area] 紅色按紐 (需二次確認)，用於移除錯誤建立的領域 (非隱藏)。**

![Area Detail V2 UI](./wireframe/3.4.2_area_detail.png)


## 3.5 資源庫 (Resources)

### 說明
資源庫是系統中「已處理資訊」的長期存放與檢索中樞。
*   **低噪音檢索**: 僅顯示已明確歸類的資訊，排除 Inbox 的雜訊。
*   **多維度索引**: 支援透過專案、領域及標籤進行交叉篩選。
*   **長期回溯**: 即使專案已完成，關聯的資源仍保留在此供隨時調閱。

### 3.5.1 資源庫清單頁 (Resource Library Page)

*   **說明**: 
    *   展示所有狀態為 `Processed` 與 `Archived` 的資源。
    *   預設視圖僅顯示 `Processed`，以維持介面簡潔。
*   **布局**:
    *   **頂部**: 標題 "Resources"、全域過濾列 (Filter Bar)。
    *   **內容區**: 以單欄列表 (List View) 呈現。
*   **元件**:
    *   **過濾列 (Filter Bar)**:
        *   **狀態篩選**: 下拉選單 (Processed / Archived / All)。
        *   **關聯篩選**: 按 Project 或 Area 進行過濾。
        *   **標籤篩選器**: 點擊標籤進行聯集/交集篩選。
    *   **資源清單項目 (List Item)**:
        *   **圖示**: 筆記 (Note) 圖示。
        *   **主要資訊**: 標題與內文摘要預覽。
        *   **參考連結指標 (Source Link Indicator)**: 若該筆記具備 `sourceLink`，於標題旁顯示一個小型的外部連結圖示。
        *   **關聯標記 (Context Badges)**: 顯示該資源所屬的所有 Project 與 Area 標籤 (Badges)。
        *   **標籤列表**: 呈現該資源的 Tags。
        *   **狀態指示器**: 若資源為 `Archived`，項目背景或文字加深/淡化，並加註「Archived」標記。
*   **行為**:
    *   **搜尋**: 輸入關鍵字即時連動清單。
    *   **點擊跳轉**: 進入「資源內容編輯頁 (3.2.2)」。
    *   **快速操作 (Quick Actions)**: 
        *   **重現分流 (Re-link)**: 開啟 Command Palette 選單更新關聯的 Project / Area。
        *   **變更狀態**: 封存 (Archive) 或 取消封存 (Restore)。
        *   **刪除**: 移至垃圾桶。

## 3.6 指標管理 (Metrics)

### 說明
指標管理協助用戶定義與量化需要長期觀察的狀態。
*   **多樣化紀錄**：支援類別、數值、序位與時間等多種維度。
*   **日記整合**：定義後的指標會自動出現在每日日記 (Journal) 的填寫清單中。
*   **睡眠自動化**：內建專屬睡眠追蹤邏輯，自動計算睡眠長度與趨勢。

### 3.6.1 指標類型與配置

系統提供以下四種基本維度供用戶自定義指標：

| 類型 | 適用場景範例 | 配置參數 | 日記輸入元件 |
| :--- | :--- | :--- | :--- |
| **Select (預設選項)** | 心情、氣候、集中度 | 選項清單 (options) | 標籤組 (Tag Group) |
| **Number (數值填空)** | 體重、跑步里程、飲水量 | 單位 (unit) | 數字輸入框 (Number Input) |
| **Rating (評分系統)** | 能量、壓力感 | 無 | 1-10 評分滑桿 (Slider) |
| **Time (時間點)** | 靜坐開始時間、下班時間 | 無 | 時間選擇器 (Time Picker) |

### 3.6.2 系統預設指標：睡眠追蹤 (Sleep Tracking)

系統內建一組特殊的指標用於追蹤睡眠質量，用戶可選擇是否啟用此追蹤。

*   **輸入方式**：
    *   **入睡時間 (Sleep At)**：記錄**昨晚**入睡的時刻。
    *   **起床時間 (Wake Up At)**：記錄**今日**醒來的時刻。
*   **自動計算**：系統依據兩者自動計算「當日睡眠總時數」。
*   **開關控制**：在 Metrics 管理頁面中，用戶可以選擇「暫停/啟用」此系統指標。

### 3.6.3 指標列表頁 (Metrics List Page)

*   **說明**：管理所有指標的定義、啟用狀態與排序。
*   **布局**：清單式佈局，區分「啟用中」與「已停用」區塊。
*   **元件**：
    *   **指標卡片**：顯示名稱、類型、最後紀錄值。
    *   **預設指標標記**：如「睡眠追蹤」會標示為系統指標。
*   **行為**：
    *   **新增指標**：開啟 Modal 引導選擇類型並設定屬性（如選項、單位）。
    *   **排序拖曳**：影響在日記中出現的先後順序。
    *   **狀態切換**：快速切換 `isActive`。
    *   **編輯與刪除**：
        *   **[Edit]**: 修改指標名稱、單位或選項清單。
        *   **[Delete]**: 硬刪除指標 (需警告會遺失歷史數據)。

### 3.6.4 指標數據紀錄邏輯

*   **儲存點**：指標數據僅在日記 (Journal) 中填寫時產生 `MetricEntry`。
*   **空值處理**：若當日未填寫，不產生 Entry，統計時不予計入（而非計為 0）。

## 3.7 日記 (Journal)

### 說明
日記是系統的「每日觀測視窗」，旨在提供一個低干擾、可回溯的介面，讓用戶記錄當日狀態並檢視行動。
*   **數據聚合**：自動彙整當日對應的習慣、指標、專案與任務。
*   **上下文參考**：透過「資源足跡 (Resource Footprints)」回溯當日的知識輸入。
*   **行動引導**：不只是紀錄，更是每日行動的啟動點。

### 3.7.1 頁面結構與區塊佈局

日記頁面採多區塊式設計，依據重要性與操作頻率排列：

1.  **結構化紀錄區 (左側 60%)**：
    *   **每日筆記 (Daily Note)**：開放式的 Markdown 編輯區 (Plate.js)，用於撰寫摘要或隨手記。
    *   **資源足跡 (Resource Footprints)**：自動顯示該日「建立」或「修改過」的資源清單。這能幫助用戶回想起當天看了什麼、想了什麼（類似數位足跡）。
2.  **狀態與行動區 (右側 40%)**：
    *   **習慣勾選 (Habit Checklist)**：顯示當日需執行的 `Active` 習慣。
    *   **指標填寫 (Metrics Tracking)**：顯示已啟用的指標（含睡眠模組）錄入元件。
    *   **行動引導 (Action Guide)**：
        *   **進行中專案**：顯示當前 `Active` 專案清單與進度。
        *   **焦點任務**：顯示 Workbench 中 `Doing` 的任務，作為今日重點回顧。

### 3.7.2 核心行為邏輯

*   **快速切換日期 (Date Navigation)**：
    *   **日曆選擇器**：點擊頂部日期開啟 Calendar 小視窗進行快速選轉。
    *   **快捷按鈕**：提供 `< Today >` 按紐，快速移動至前後一日或重置回今日。
    *   **鍵盤快捷鍵**：支援 `Ctrl + [` (前一天) 與 `Ctrl + ]` (下一天)，方便在日記視圖中快速導覽前後日期的紀錄。
*   **任務勾選同步**：
    *   在日記中「檢視」任務。若用戶在日記中勾選完成任務，狀態將與專案管理同步。
    *   目的是讓用戶在寫筆記時，不需切換頁面就能標記今日成果。
*   **睡眠自動帶入**：當用戶查看「今日」日記時，睡眠模組會提示輸入「昨晚至今日」的睡眠數據。
*   **資源關聯鎖定**：在日記頁面點擊某個資源足跡，直接滑出預覽窗格，方便快速引用內容。
*   **回溯補填機制 (Backfilling)**：
    *   **靈活性**：允許用戶透過日曆切換至過去任何日期補填日記、習慣或指標。
    *   **限制**：未來日期僅供檢視專案與任務，不可建立日記或錄入數據。

### 3.7.3 日記生成機制

*   **自動初始化**：用戶每日首次進入 Journal 頁面時，系統自動為該日期建立 `Journal` 實體。
*   **持久化**：所有的 `HabitLog`、`MetricEntry` 與 `DailyNote` 皆即時儲存。

## 3.8 全域設定 (Settings)

### 說明
全域設定是控制產品體驗、帳號安全與訂閱狀態的核心入口。用戶點擊左側導航欄底部的「會員資訊摘要」即可進入。
*   **模組化設計**：透過分頁 (Tabs) 組織不同功能的配置。
*   **即時呈現**：部分設定 (如 Theme) 應支援即時生效，無需手動儲存。

### 3.8.1 一般設定 (General & Account)

*   **帳號資訊**：
    *   顯示登入方式 (Google / GitHub) 與對應的 Email。
    *   **顯示名稱 (Display Name)**：提供輸入框允許用戶修改系統內的稱呼。
    *   **頭像管理**：顯示當前頭像，點擊可開啟上傳/更換介面。
*   **早期存取 (Early Access)** - *針對 Phase 2 規劃*：
    *   **推薦碼輸入 (Referral Code)**：輸入特定的邀請碼/推薦碼，轉換為「終身免費會員」或取得特殊權限。

### 3.8.2 外觀樣式 (Appearance)

*   **主題切換 (Theme)**：
    *   提供兩個選項：**深色模式 (Kernel Dark)**、**淺色模式 (Kernel Light)**。
    *   (備註：未來可擴充「跟隨系統」選項)。
*   **系統字型 (System Font)**：
    *   提供 3-4 種字型清單切換（如：Inter, Roboto, Noto Sans TC 等）。
    *   *注意：字型更換僅影響導航欄、清單與標題，不影響 編輯器內部的撰寫體驗。*

### 3.8.3 快捷鍵配置 (Keyboard Shortcuts)

列出系統主要快捷鍵，並允許用戶（未來）自定義或僅供查看：
*   **快速捕捉 (Quick Capture)**：預設 `Ctrl + Q`。
*   **切換日記日期 (Toggle Journal Date)**：預設 `Ctrl + [` (前一天) / `Ctrl + ]` (後一天)。
*   **全域搜尋 (Global Search)**：預設 `Cmd/Ctrl + K`。

### 3.8.4 訂閱管理 (Billing & Subscription)

管理財務與付費權限的核心分頁：
*   **方案狀態**：顯示目前等級（免費 / 推薦碼 / Pro）。
*   **訂閱動作**：升級方案 (Upgrade)、取消訂閱 (Cancel)。
*   **付款資訊**：
    *   **目前方式**：顯示綁定的信用卡後四碼與發卡組織圖示。
    *   **付款歷史**：以表格顯示日期、項目、金額，並提供「下載發票 (Invoice)」連結。

## 3.9 儀表板 (Dashboard)

### 說明
儀表板將系統內累積的數據轉化為可視化的洞察，協助用戶了解自身狀態、習慣養成進度與工作系統的健康程度。
*   **全量化監控**：除了類別型 (Select) 指標外，其餘數據皆支援圖表化呈現。
*   **系統完整性**：追蹤 PARA 核心實體的運轉狀態。
*   **行為追蹤**：除了預設習慣外，同步追蹤「寫日記」的頻率。

### 3.9.1 頁面佈局與元件

儀表板採組合式 (Modular) 設計，包含以下核心區塊：

1.  **系統運行狀況 (System Integrity Summary)**：
    *   以數據卡片 (Stat Cards) 呈現：
        *   **「大腦同步天數 (Brain-Sync Days)」**：記錄系統自建立以來的使用總天數（寫過日記的天數）。
        *   **Inbox 未處理數**：目前的 Pending Resources 數量。
        *   **進行中專案 (Active Projects)**：當前正在推進的目標數。
        *   **待辦任務數 (Total Tasks)**：Active 專案下的未完成任務總量。
2.  **今日與近期概覽 (Daily Overview)**：
    *   **行動熱力圖 (Activity Heatmap)**：
        *   橫軸為日期，縱軸為行為（寫日記、各項習慣）。
        *   **連續達成天數 (Current Streaks)**：在每項習慣名稱旁顯示目前的連續不中斷天數 (e.g., 🔥 7 days)。
        *   **寫日記行為**：若該日有 `Journal` 實體，則顯示為已達成。
    *   **睡眠趨勢圖**：顯示最近 7/30 天的睡眠長度變化。
3.  **指標監控 (Metrics Visualization)**：
    *   **數值/評分趨勢**：使用折線圖 (Line Chart) 呈現 Number 與 Rating 類型的長期變化。
    *   **時間分佈**：使用點圖 (Dot Plot) 呈現時間類型指標（如：下班時間）的波動。
4.  **關聯性分析工具 (Correlation Tool)**：
    *   **自定義比較**：允許用戶從兩個 Y 軸中選擇不同的數據進行交叉對比（例如：睡眠長度 vs. 能量評分，或 運行里程 vs. 體重）。

### 3.9.2 可視化邏輯細節

| 指標類型 | 可視化方式 | 處理邏輯 |
| :--- | :--- | :--- |
| **Select** | 清單或佔比圖 | 適合顯示近期最常出現的狀態選項分配。 |
| **Number** | 折線圖 / 柱狀圖 | 顯示絕對數值變化。 |
| **Rating** | 區域折線圖 (Area) | 1-10 的波動範圍。 |
| **Time** | 分佈散點圖 | 將 HH:mm 轉換為分鐘數進行繪圖。 |
| **Sleep** | 雙軸圖 / 累積圖 | 顯示入睡/起床時間點與總睡眠時數。 |

### 3.9.3 交互行為與計算規則

*   **連續天數計算 (Streak Logic)**：
    *   依據數據產生的「邏輯日期」計算，而非「錄入時間」。
    *   補填過去日期的數據將會觸發重新計算，並自動修復先前中斷的連續紀錄。
*   **時間範圍切換**：頂部提供切換開關 (7D / 30D / 90D / 1Y)。
*   **圖表懸停 (Hover)**：顯示該點的具體數值與日期。

---

# 4. 設計風格 (Design Guide)
請參考 `doc/4.design_guide.md`。
# 5. 系統技術架構 (Tech Stack)
- **Frontend**: Next.js 15 (App Router)
- **Backend**: Next.js API Routes + tRPC
- **Communication**: tRPC (端到端 Type-Safe)
- **Database**: Supabase (PostgreSQL + Auth)
- **Deployment**: Vercel (Monorepo 單一部署)
- **Editor**: TipTap

# 6. Roadmap: AI Coding 敏捷開發路線圖

本專案採用 AI 輔助開發模式，強調「快速迭代」、「可視化優先」與「真實回饋」。開發流程分為十個階段。

## Phase 1: 基礎建設與環境 (Foundation)
**目標**：確保本地開發環境運作正常，技術棧基底建立完成。
1.  **專案初始化**: 使用 `create-t3-app` 建置基於 Next.js 15 的專案結構。
2.  **環境變數設定**: 配置 `.env`，包含 Supabase URL, Anon Key 等基礎設定。
3.  **依賴安裝**: 安裝核心套件，包括 `tiptap` (編輯器), `i18next` (多語系), `tailwindcss`, `shadcn/ui` 等。
4.  **Hello World**: 確保 `npm run dev` 可以在瀏覽器中看到首頁，並確認 Hot Reload 正常運作。

## Phase 2: 全站頁面實作 (All Pages Prototype)
**目標**：在不串接真實資料庫的情況下，完成全站所有關鍵頁面的 UI/UX 互動，並確保 Mock Data 覆蓋各種狀態。
1.  **Mock Data 建立**: 建立全方位的假資料工廠，針對每種實體產生多種狀態 (e.g., Active/Archived Project, Input/Image Resource, Streak/Broken Habit)。
2.  **頁面實作清單**:
    *   **Auth**: Login / Register 頁面。
    *   **Landing / Dashboard**: 總覽儀表板 (Review Dashboard)。
    *   **Inbox**: 資源清單 (Inbox List) 與 快速捕捉 (Quick Capture Modal)。
    *   **Resources**: 資源庫清單 (Resource Library) 與 內容編輯頁 (Editor)。
    *   **Projects**: 專案列表/工作台 (Project List/Workbench) 與 專案詳情頁 (Detail)。
    *   **Areas**: 領域列表 (Grid View) 與 領域詳情/習慣管理 (Detail)。
    *   **Metrics**: 指標設定列表 (Configuration)。
    *   **Journal**: 每日回顧頁面 (Daily View)。
    *   **Settings**: 系統設定與標籤管理。
3.  **互動流程驗證**: 確認路由切換、Modal 開關、拖拉排序 (Drag & Drop) 等互動流暢度。
4.  **風格微調**: 依據 `4.design_guide.md` 調整 Typography, Colors, Spacing 與 Dark Mode 表現。

## Phase 3: 資料庫整合與邏輯實作 (Backend Integration)
**目標**：將靜態頁面轉化為動態應用，串接 Supabase 與 tRPC。
1.  **Schema Deployment**: 將完善的 Prisma Schema 推送至 Supabase PostgreSQL。
2.  **tRPC Router 實作**: 依據 Data Model 實作 `user`, `note`, `project`, `metric` 等 tRPC Routers。
3.  **前端資料串接**: 將 Mock Data 替換為 `trpc.useQuery` 與 `trpc.useMutation`。
4.  **認證整合**: 實作 Supabase Auth (Email/Social Login) 與 User Context 保護機制。

## Phase 4: 測試與安全性 (QA & Security)
**目標**：確保系統穩定，資料與存取權限無誤。
1.  **E2E 測試**: 使用 Playwright 錄製並測試關鍵路徑 (註冊 -> 新增 Note -> 檢查 Dashboard)。
2.  **RLS 檢查**: 嚴格檢查 Supabase Row Level Security (RLS) 規則，確保使用者只能存取自己的資料。
3.  **Input Validation**: 強化 Zod Schema 驗證，防止惡意輸入。

## Phase 5: 部署與初期驗證 (Deployment & Alpha)
**目標**：將服務推上雲端，進行真實環境測試。
1.  **Vercel 部署**: 設定 GitHub Actions CI/CD，連結 Vercel Project，確保 Push 即部署。
2.  **個人狗食測試 (Dogfooding)**: 開發者本人開始遷移真實資料至 Kernel，進行至少 3-7 天的日常使用。
3.  **Bug Bash**: 根據個人使用經驗，快速修復 UI UX 痛點與效能問題。

## Phase 6: 親友限量測試 (Closed Beta)
**目標**：將範圍擴大至可信任的小型群體，收集外部回饋。
1.  **邀請碼機制**: 實作簡單的邀請碼或白名單機制，限制註冊人數 (e.g., 5-10 人)。
2.  **觀察與訪談**: 觀察親友使用狀況，收集關於「上手難度」與「功能缺口」的回饋。
3.  **多語系驗證**: 確認 i18n 切換在不同語系使用者的裝置上顯示正常。

## Phase 7: 公開測試 (Open Beta / Soft Launch)
**目標**：面向公眾開放，驗證系統承載與擴展性。
1.  **Landing Page 優化**: 強化產品價值傳遞，準備 SEO Metadata。
2.  **開放註冊**: 移除白名單限制（或改為 Waitlist 模式）。
3.  **Analytics 監控**: 埋設 PostHog 或 Google Analytics，觀察使用者行為漏斗 (Retention/Churn)。

## Phase 8: 正式上線與商業化 (Global Launch)
**目標**：推向全球市場，開啟營收模式。
1.  **多國語系完善**: 確保所有文案翻譯到位 (EN/TW/JP/CN...)。
2.  **Stripe 串接**: 實作訂閱制 (SaaS Subscription) 金流與權限分級 (Free/Pro)。
3.  **全球行銷**: 透過 Product Hunt, Social Media 進行發布。
